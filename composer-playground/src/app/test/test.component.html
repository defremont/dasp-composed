<!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<section *ngIf="!isAdmin()" class="side-bar">
    <div class="registries">
        <h2>Articles</h2>
        <section class="side-bar-nav">
            <ul class="registry">
                <li
                    [class.active]="chosenMenu === 'upload'"
                    (click)="setChosenMenu('upload')"
                >
                <h3>Upload Article</h3>
                </li>
                <li
                    [class.active]="chosenMenu === 'myArticles'"
                    (click)="setChosenMenu('myArticles')"
                >
                    <h3>My Articles</h3>
                </li>
                <li
                    [class.active]="chosenMenu === 'publicArticles'"
                    (click)="setChosenMenu('publicArticles')"
                >
                    <h3>Public Articles</h3>
                </li>
            </ul>
        </section>
        <h2>Revisions</h2>
        <section class="side-bar-nav">
            <ul class="registry">
                <li
                    [class.active]="chosenMenu === 'toReview'"
                    (click)="setChosenMenu('toReview')"
                >
                    <h3>To Review</h3>
                </li>
                <li
                    [class.active]="chosenMenu === 'myArticleRevisions'"
                    (click)="setChosenMenu('myArticleRevisions')"
                >
                    <h3>My Articles Revisions</h3>
                </li>
                <li
                    [class.active]="chosenMenu === 'publicRevisions'"
                    (click)="setChosenMenu('publicRevisions')"
                >
                    <h3>Public Revisions</h3>
                </li>
            </ul>
        </section>
        <h2>Profile</h2>
        <section class="side-bar-nav">
            <ul class="registry">
                <li
                    *ngFor="
                        let participantRegistry of registries['participants']
                    "
                    [class.active]="
                        chosenRegistry &&
                        chosenRegistry.id === participantRegistry.id
                    "
                    (click)="setChosenRegistry(participantRegistry)"
                >
                    <h3>My Profile</h3>
                </li>
            </ul>
        </section>

        <!-- <h2>Transactions</h2>
        <section class="side-bar-nav">
            <ul class="registry">
                <li
                    [class.active]="
                        chosenRegistry &&
                        chosenRegistry === registries['historian']
                    "
                    (click)="setChosenRegistry(registries['historian'])"
                >
                    <h3>All Transactions</h3>
                </li>
            </ul>
        </section> -->
    </div>
<!--
    <div class="side-button">
        <div class="button-item">
            <button
                [disabled]="!hasTransactions"
                type="button"
                class="primary"
                (click)="submitTransaction()"
            >
                <span>Submit Transaction</span>
            </button>
        </div>
    </div> -->
</section>

<section *ngIf="!isAdmin() && chosenMenu === 'toReview'" class="main-view">
    <div class="modal-header">
        <h1>Revisions to Review</h1>
    </div>
    <div class="main-view-content">
        <registry
            [registry]="chosenRegistry"
            [reload]="registryReload"
            [type]="'review'"
        ></registry>
    </div>

    <app-footer></app-footer>
</section>
<section *ngIf="!isAdmin() && chosenMenu === 'myArticles'" class="main-view">
    <div class="modal-header">
        <h1>Your Articles</h1>
    </div>
    <div class="main-view-content">
        <registry
            [registry]="chosenRegistry"
            [reload]="registryReload"
            [type]="'myArticles'"
        ></registry>
    </div>

    <app-footer></app-footer>
</section>
<section *ngIf="!isAdmin() && chosenMenu === 'publicArticles'" class="main-view">
    <div class="modal-header">
        <h1>Public Published Articles</h1>
    </div>
    <div class="main-view-content">
        <registry
            [registry]="chosenRegistry"
            [reload]="registryReload"
            [type]="'publicArticles'"
        ></registry>
    </div>

    <app-footer></app-footer>
</section>
<section *ngIf="!isAdmin() && chosenMenu === 'myArticleRevisions'" class="main-view">
    <div class="modal-header">
        <h1>Revisions from your Articles</h1>
    </div>
    <div class="main-view-content">
        <registry
            [registry]="chosenRegistry"
            [reload]="registryReload"
            [type]="'myArticleRevisions'"
        ></registry>
    </div>

    <app-footer></app-footer>
</section>
<section *ngIf="!isAdmin() && chosenMenu === 'publicRevisions'" class="main-view">
    <div class="modal-header">
        <h1>Public published Revisions</h1>
    </div>
    <div class="main-view-content">
        <registry
            [registry]="chosenRegistry"
            [reload]="registryReload"
            [type]="'publicRevisions'"
        ></registry>
    </div>

    <app-footer></app-footer>
</section>
<section *ngIf="!isAdmin() && chosenMenu === 'upload'" class="main-view">
    <div class="modal-header">
        <h1>Upload Article</h1>
    </div>
    <!-- <div class="modal-header">
        <h3 style="color:#af3f3f" *ngIf="!ipfsOk">IPFS IS OFFLINE</h3>
    </div> -->

    <section class="modal-body">
        <section class="resource-container">
            <section class="resource-component">
                <div>
                    <div>
                        <p class="resource-preview-text">Upload Article:</p>
                    </div>

                    <button
                        *ngIf="loadingHash"
                        type="button"
                        class="primary"
                        [disabled]="loadingHash"
                    >
                        <div
                            class="ibm-spinner-indeterminate small loop"
                            ngDefaultControl
                        >
                            <div class="loader">
                                <svg class="circular" viewBox="25 25 50 50">
                                    <circle
                                        class="circle-path"
                                        cx="50"
                                        cy="50"
                                        r="20"
                                    />
                                </svg>
                            </div>
                        </div></button
                    ><a target="_blank" href="https://ipfs.infura.io:5001/api/v0/cat/{{articleHash}}" >{{ articleHash }}</a>
                    <div>
                        <input
                            required
                            name="article"
                            type="file"
                            accept="application/pdf"
                            (change)="handleInputChange($event)"
                        />
                    </div>

                    <!-- <button (click)="downloadFile()">Download</button> -->
                </div>

                <div>
                    <p class="resource-preview-text">Tags:</p>
                </div>
                <input
                    required
                    type="text"
                    name="tags"
                    id="tags"
                    [(ngModel)]="tags"
                    (change)="tag()"
                    autocomplete="off"
                /><div>
                        <!-- <input
                            required
                            type="checkbox"
                            name="isPaid"
                            id="isPaid"
                            [(ngModel)]="isPaid"
                            (change)="paid()"
                            autocomplete="off"
                        />
                        <label for="isPaid" class="checkbox-label">Paid?</label> -->
                        </div>
                <div class="resource-error-text" ng-if="definitionError!=null">
                    <p>{{ definitionError }}</p>
                </div>
            </section>
        </section>
    </section>

    <footer>
        <div class="transaction-footer-cta">
            <!-- <button type="button" class="primary" (click)="test()">
                <div>
                    <span>Test</span>
                </div>
            </button> -->
            <button
                name="submitButton"
                id="submitTransactionButton"
                type="button"
                class="primary"
                (click)="submitSpecTransaction()"
                [disabled]="
                    definitionError != null ||
                    submitInProgress ||
                    !articleBase64 ||
                    !tags
                "
                ngDefaultControl
            >
                <div *ngIf="!submitInProgress && !loadingHash" ngDefaultControl>
                    <span>Submit</span>
                </div>
                <div
                    *ngIf="submitInProgress && !loadingHash"
                    class="ibm-spinner-indeterminate small loop"
                    ngDefaultControl
                >
                    <div class="loader">
                        <svg class="circular" viewBox="25 25 50 50">
                            <circle
                                class="circle-path"
                                cx="50"
                                cy="50"
                                r="20"
                            />
                        </svg>
                    </div>
                </div>
                <div *ngIf="loadingHash" ngDefaultControl>
                    <span>Loading Hash...</span>
                </div>
            </button>
        </div>
    </footer>

    <app-footer></app-footer>
</section>
<section *ngIf="!isAdmin() && chosenMenu === null" class="main-view">
    <div class="main-view-content">
        <registry
            [registry]="chosenRegistry"
            [reload]="registryReload"
        ></registry>
    </div>

    <app-footer></app-footer>
</section>
<section *ngIf="isAdmin()" class="main-view">
    <div class="main-view-content">
        <div class="no-resources">
            <svg class="ibm-icon" aria-hidden="true">
                <use xlink:href="#icon-Emptiness"></use>
            </svg>
            <h3>Nothing to see here...</h3>
            <p>PLEASE GO BACK & LOG-IN! >:(</p>
        </div>
    </div>

    <app-footer></app-footer>
</section>
